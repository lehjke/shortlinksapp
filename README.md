# Сервис сокращения ссылок

Консольное Java‑приложение, которое принимает длинный URL и выдаёт уникальные короткие ссылки для каждого пользователя. Сервис контролирует срок жизни ссылок, ограничение по количеству переходов и уведомляет пользователя о недоступности ссылки.

## Возможности
- Генерация коротких ссылок вида `https://lehjke.ru/XXXXXXX`.
- Уникальные ссылки даже при одинаковом исходном URL у разных пользователей.
- Лимит переходов, задаваемый пользователем на этапе создания ссылки.
- Автоматическое удаление ссылок после истечения системного TTL (по умолчанию 24 часа).
- Уведомления при исчерпании лимита либо просрочке ссылки.
- UUID как единственный идентификатор пользователя без авторизации.
- Автоматический переход по короткой ссылке через `Desktop.getDesktop().browse`.

## Быстрый старт
1. Убедитесь, что установлен JDK 17 (либо воспользуйтесь включённым Maven Wrapper'ом).
2. Соберите и запустите приложение:
   ```powershell
   .\mvnw.cmd clean package
   java -cp target\shortlinksapp-1.0-SNAPSHOT.jar com.shortlinks.App
   ```
   На Linux/macOS используйте `./mvnw`.

Во время первого запуска будет создан файл хранения `data/store.json`.

## Сценарий работы
1. **Регистрация пользователя** – выберите пункт меню и получите свой UUID. Сохраните его, он понадобится для дальнейшей работы.
2. **Вход** – укажите ранее полученный UUID, чтобы управлять своими ссылками (создавать, просматривать, редактировать, удалять).
3. **Создание ссылки** – введите исходный URL и лимит переходов. TTL задаётся системой автоматически.
4. **Переход по короткой ссылке** – доступен из любого меню. Достаточно ввести короткий код или полный URL; при успешной проверке откроется браузер.
5. **Удаление** – доступно только владельцу ссылки и требует указания короткого кода.
6. **Редактирование** – владелец может изменить лимит переходов и/или продлить TTL для любой своей ссылки.

## Команды консоли

- `1` — регистрация нового пользователя.
- `2` — вход по ранее полученному UUID.
- `3` — открыть ссылку (доступно и без входа).
- `1` (в пользовательском меню) — создать короткую ссылку.
- `2` — вывести список своих ссылок с лимитом и TTL.
- `3` — удалить ссылку.
- `4` — открыть короткую ссылку прямо из пользовательского меню.
- `5` — изменить лимит переходов и/или продлить TTL для выбранной ссылки.
- `0` — выход из текущего меню.

Сервис отображает оставшийся TTL и количество использованных переходов для каждой ссылки.

## Конфигурация
Настройки расположены в `src/main/resources/application.properties`:

| Ключ | Значение по умолчанию | Описание |
| --- | --- | --- |
| `app.short-link-domain` | `https://lehjke.ru/` | Базовый домен для коротких ссылок. |
| `app.short-code-length` | `7` | Длина генерируемого кода. |
| `app.default-ttl-hours` | `24` | Время жизни ссылки в часах. |
| `app.cleanup-interval-seconds` | `60` | Периодичность фоновой очистки просроченных ссылок. |
| `app.storage-file` | `data/store.json` | Путь к файлу хранения ссылок и пользователей. |
| `app.open-browser` | `true` | Управляет автоматическим открытием браузера. Для автотестов можно временно установить `false`. |

Любой параметр можно переопределить через `-D` при запуске, например:
```
java -Dapp.default-ttl-hours=1 -cp target/shortlinksapp-1.0-SNAPSHOT.jar com.shortlinks.App
```

## Тестирование
```
.\mvnw.cmd clean test
```
Покрытие включает ключевые сценарии сервиса:
- Уникальные коды для разных пользователей.
- Блокировка после достижения лимита.
- Поведение просроченных ссылок и работа фоновой очистки.

## Структура
- `docs/design.md` – высокоуровневое описание архитектуры.
- `src/main/java` – реализация консольного сервиса, включая планировщик очистки и файловое хранилище.
- `src/test/java` – модульные тесты `ShortLinkService`.
- `data/store.json` – автоматически создаваемый файл с данными пользователей и ссылок.

## Дальнейшие шаги
- Перенос хранилища в БД (PostgreSQL) через реализацию нового репозитория.
- Добавление REST API поверх существующего сервисного слоя.
- Поддержка альтернативных каналов уведомлений (e-mail, веб-хуки).
